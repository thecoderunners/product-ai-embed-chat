(function(){"use strict";Promise.resolve().then(()=>k).then(g=>{const o=g.default,s=document.createElement("style");s.textContent=o,document.head.appendChild(s)}),function(){function g(){const t=document.currentScript;if(t&&t.getAttribute("data-api-key"))return t.getAttribute("data-api-key");const n=document.querySelectorAll('script[type="module"]');for(const r of n)if(r.getAttribute("data-api-key")&&(r.src.includes("chat-widget")||r.src.includes("script.js")))return r.getAttribute("data-api-key");const e=document.querySelector("script[data-api-key]");return e?e.getAttribute("data-api-key"):(console.warn("Could not find API key from script tag"),null)}if(!document.querySelector('meta[name="viewport"]')){const t=document.createElement("meta");t.name="viewport",t.content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no",document.head.appendChild(t)}const o={info:(...t)=>console.log("üì± [Chat Widget]:",...t),error:(...t)=>console.error("‚ùå [Chat Widget]:",...t),warn:(...t)=>console.warn("‚ö†Ô∏è [Chat Widget]:",...t)};o.info("Initializing chat widget...");const s=document.createElement("div");s.id="my-chat-widget",s.style.position="fixed",s.style.bottom="20px",s.style.right="20px",s.style.zIndex="10000",document.body.appendChild(s),o.info("Chat container created");const f=document.createElement("button");f.className="chat-toggle",f.innerHTML=`
    <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
      <path d="M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z"></path>
    </svg>
  `,s.appendChild(f);const d=document.createElement("div");d.id="my-chat-window",s.appendChild(d),o.info("Chat button and window created"),g();const z=g();let u=!1;function x(){return window.innerWidth<768}function b(){o.info("Toggling chat window, current state:",u),u?(d.classList.remove("chat-show"),d.classList.add("chat-hide"),d.addEventListener("animationend",()=>{d.style.display="none",u=!1,document.documentElement.classList.remove("chat-open"),document.body.classList.remove("chat-open"),document.body.style.overflow=""},{once:!0})):(d.style.display="block",d.classList.add("chat-show"),d.classList.remove("chat-hide"),u=!0,x()&&(document.documentElement.classList.add("chat-open"),document.body.classList.add("chat-open"),document.body.style.overflow="hidden",setTimeout(()=>{window.scrollTo(0,0)},10)),S())}f.addEventListener("click",b),window.addEventListener("resize",()=>{if(u){const t=document.getElementById("chat-body");t&&(t.style.height=x()?"calc(100% - 120px)":"calc(100% - clamp(120px, 25vh, 140px))")}});function S(){o.info("Loading chat interface..."),$()}function $(){d.innerHTML=`
      <div id="chat-header">
        <span>Chat</span>
        <button class="close-button" aria-label="Close chat">
          <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <line x1="18" y1="6" x2="6" y2="18"></line>
            <line x1="6" y1="6" x2="18" y2="18"></line>
          </svg>
        </button>
      </div>
      <div id="chat-body"></div>
      <div id="chat-footer">
        <input type="text" id="chat-input" placeholder="Type a message..." />
        <button id="voice-button" title="Voice Input">
          <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <path d="M12 1a3 3 0 0 0-3 3v8a3 3 0 0 0 6 0V4a3 3 0 0 0-3-3z"></path>
            <path d="M19 10v2a7 7 0 0 1-14 0v-2"></path>
            <line x1="12" y1="19" x2="12" y2="23"></line>
            <line x1="8" y1="23" x2="16" y2="23"></line>
          </svg>
        </button>
        <button id="send-message">
          <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <line x1="22" y1="2" x2="11" y2="13"></line>
            <polygon points="22 2 15 22 11 13 2 9 22 2"></polygon>
          </svg>
        </button>
      </div>
    `,d.querySelector(".close-button").addEventListener("click",n=>{n.stopPropagation(),b()}),h({type:"text",content:"Hi! How can I help you today?"}),C(),o.info("Chat interface loaded and initialized")}function h(t){const n=document.getElementById("chat-body"),e=document.createElement("div");switch(e.className="message server-message",t.type){case"text":e.innerHTML=`
            <div class="message-content">
              ${t.content}
            </div>
          `;break;case"product":const i=t.originalPrice?Math.round((t.originalPrice-t.price)/t.originalPrice*100):0,a=t.rating?E(t.rating):"";e.innerHTML=`
            <div class="product-card">
              <div class="product-image-container">
                <img src="${t.imageUrl}" alt="${t.title}" loading="lazy" />
                ${i>0?`<div class="discount-badge">-${i}%</div>`:""}
              </div>
              <div class="product-details">
                <h4>${t.title}</h4>
                <div class="product-rating">${a}</div>
                <p>${t.description}</p>
                <div class="product-price">
                  <strong>${w(t.price)}</strong>
                  ${t.originalPrice?`<span class="original-price">${w(t.originalPrice)}</span>`:""}
                </div>
                ${t.shipping?`<div class="shipping-info">${t.shipping}</div>`:""}
                ${t.inStock===!1?'<div class="out-of-stock">Out of Stock</div>':""}
              </div>
              <div class="product-actions">
                ${t.actions.map(p=>`
                  ${p.url?`<a href="${p.url}" class="product-action-button" data-action="${p.value}">${p.label}</a>`:`<button class="product-action-button" data-action="${p.value}">${p.label}</button>`}
                `).join("")}
              </div>
            </div>
          `;break;case"action":e.innerHTML=`
          <div class="message-content">
            <p>${t.question}</p>
            <div class="action-buttons">
              ${t.options.map(p=>`<button class="action-button" data-action="${p.value}">${p.label}</button>`).join("")}
            </div>
          </div>
        `;break;case"image":e.innerHTML=`
          <div class="message-content">
            <img src="${t.imageUrl}" alt="Image message" style="max-width:100%; border-radius:8px;" />
            ${t.caption?`<p>${t.caption}</p>`:""}
          </div>
        `;break;default:e.innerHTML=`<div class="message-content">${t}</div>`}n.appendChild(e),n.scrollTop=n.scrollHeight,e.querySelectorAll(".action-button, .product-action-button:not(a)").forEach(i=>{i.addEventListener("click",()=>{const a=i.getAttribute("data-action");o.info("Action button clicked:",a),v({action:a})})})}function E(t){const n=Math.round(t*2)/2;let e="";for(let i=1;i<=Math.floor(n);i++)e+='<span class="star full">‚òÖ</span>';n%1!==0&&(e+='<span class="star half">‚òÖ</span>');const r=5-Math.ceil(n);for(let i=0;i<r;i++)e+='<span class="star empty">‚òÜ</span>';return`<div class="stars">${e}</div><span class="rating-value">${t.toFixed(1)}</span>`}function w(t){return`$${t.toFixed(2)}`}function v(t){o.info("Sending message payload to server:",t),window.chatUserIdentifier||(window.chatUserIdentifier="user-"+Math.random().toString(36).substring(2,15),o.info("Generated user identifier:",window.chatUserIdentifier));const n={token:z,message:t.message,userIdentifier:window.chatUserIdentifier};fetch("http://localhost:5173/api/chat",{method:"POST",headers:{"Content-Type":"application/json",Origin:"http://localhost:8080"},body:JSON.stringify(n)}).then(e=>(o.info("Server response received"),e.json())).then(e=>{if(o.info("Processing server response:",e),e.success&&e.message){const i=e.message.replace(/\*\*(.*?)\*\*/g,"<strong>$1</strong>").replace(/\*(.*?)\*/g,"<em>$1</em>").replace(/\n/g,"<br>");h({type:"text",content:i})}else e.messages&&Array.isArray(e.messages)?e.messages.forEach(i=>{h(i)}):h({type:"text",content:"Received response from server but in an unexpected format."});const r=document.getElementById("chat-body");r.scrollTop=r.scrollHeight}).catch(e=>{o.error("Error in server communication:",e);const r=document.getElementById("chat-body");h({type:"text",content:"Sorry, I couldn't process your message. Please try again."}),r.scrollTop=r.scrollHeight})}function C(){const t=document.getElementById("send-message"),n=document.getElementById("voice-button"),e=document.getElementById("chat-input"),r=document.getElementById("chat-body");o.info("Setting up chat messaging components");let i=!1,a=null;function p(c){return c.replace(/[<>]/g,"").trim()}function m(){const c=p(e.value);c!==""&&(o.info("Sending message:",c),I(c),e.value="",r.scrollTop=r.scrollHeight,v({message:c}))}function I(c){const l=document.createElement("div");l.className="message user-message",l.innerHTML=`<div class="message-content">${c}</div>`,r.appendChild(l),o.info("User message appended to chat")}t.addEventListener("click",m),e.addEventListener("keyup",function(c){c.key==="Enter"&&!c.shiftKey&&(c.preventDefault(),m())}),n.addEventListener("click",function(){if(!("webkitSpeechRecognition"in window)&&!("SpeechRecognition"in window)){o.warn("Speech recognition not supported in this browser"),alert("Voice recognition is not supported in your browser.");return}if(i){o.info("Stopping voice recording"),a&&a.stop();return}const c=window.SpeechRecognition||window.webkitSpeechRecognition;a=new c,a.continuous=!1,a.interimResults=!0,a.lang="en-US",a.onstart=()=>{o.info("Voice recognition started"),i=!0,n.classList.add("recording")},a.onend=()=>{o.info("Voice recognition ended"),i=!1,n.classList.remove("recording"),a=null},a.onerror=l=>{o.error("Voice recognition error:",l.error),i=!1,n.classList.remove("recording"),a=null},a.onresult=l=>{const y=Array.from(l.results).map(L=>L[0].transcript).join("");o.info("Voice recognition result:",y),e.value=y,l.results[0].isFinal&&m()};try{a.start(),o.info("Attempting to start voice recognition")}catch(l){o.error("Error starting voice recognition:",l),alert("Error starting voice recognition. Please try again.")}}),e.focus(),o.info("Chat messaging setup completed")}o.info("Chat widget initialized")}();const k=Object.freeze(Object.defineProperty({__proto__:null,default:'#my-chat-widget *{box-sizing:border-box;font-family:Inter,-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,sans-serif}#my-chat-widget button.chat-toggle{background:#6c5ce7;color:#fff;border:none;border-radius:50%;width:clamp(60px,15vw,80px);height:clamp(60px,15vw,80px);font-size:clamp(24px,4vw,32px);cursor:pointer;box-shadow:0 4px 12px #6c5ce766;transition:all .3s cubic-bezier(.4,0,.2,1);display:flex;align-items:center;justify-content:center;z-index:10001;position:relative}#my-chat-widget button.chat-toggle:hover{transform:scale(1.05);box-shadow:0 6px 16px #6c5ce780}#my-chat-widget button.chat-toggle:active{transform:scale(.95)}@media (max-width: 767px){#my-chat-widget button.chat-toggle{width:80px;height:80px;font-size:32px;position:fixed;bottom:20px;right:20px}}#my-chat-window{display:none;width:min(450px,calc(100vw - 40px));height:min(650px,80vh);background:#fff;border-radius:24px;overflow:hidden;position:fixed;bottom:100px;right:20px;box-shadow:0 12px 28px #00000026;z-index:10002;transition:all .3s ease}@media (max-width: 767px){#my-chat-window{width:100%;height:100%;bottom:0;right:0;left:0;top:0;border-radius:0;max-height:none;position:fixed;margin:0;padding:0}#my-chat-window.chat-show{animation:slideUpFullScreen .3s cubic-bezier(.4,0,.2,1) forwards}#my-chat-window.chat-hide{animation:slideDownFullScreen .3s cubic-bezier(.4,0,.2,1) forwards}}@media (min-width: 768px) and (max-width: 1023px){#my-chat-window{width:min(600px,85vw);height:min(700px,85vh)}}@media (min-width: 1024px){#my-chat-window{width:min(450px,35vw);height:min(650px,75vh)}}.chat-show{display:block!important;animation:slideUp .3s cubic-bezier(.4,0,.2,1) forwards}.chat-hide{animation:slideDown .3s cubic-bezier(.4,0,.2,1) forwards}@keyframes slideUp{0%{opacity:0;transform:translateY(20px) scale(.98)}to{opacity:1;transform:translateY(0) scale(1)}}@keyframes slideDown{0%{opacity:1;transform:translateY(0) scale(1)}to{opacity:0;transform:translateY(20px) scale(.98)}}@keyframes slideUpFullScreen{0%{opacity:0;transform:translateY(20px)}to{opacity:1;transform:translateY(0)}}@keyframes slideDownFullScreen{0%{opacity:1;transform:translateY(0)}to{opacity:0;transform:translateY(20px)}}@media (max-width: 767px){html.chat-open,body.chat-open{overflow:hidden!important;position:fixed;width:100%;height:100%}}#chat-header{background:#6c5ce7;color:#fff;padding:clamp(16px,5vw,20px);font-size:clamp(16px,4vw,18px);font-weight:600;text-align:center;display:flex;justify-content:space-between;align-items:center}@media (max-width: 767px){#chat-header{padding:1rem;position:sticky;top:0;z-index:10003;box-shadow:0 2px 8px #0000001a;font-size:20px}}.close-button{background:none;border:none;color:#fff;cursor:pointer;padding:clamp(6px,1.5vw,8px);display:flex;align-items:center;justify-content:center;border-radius:50%;transition:background-color .2s}.close-button:hover{background:#ffffff1a}.close-button svg{width:clamp(18px,5vw,20px);height:clamp(18px,5vw,20px)}#chat-body{padding:clamp(16px,5vw,20px);overflow-y:auto;height:calc(100% - clamp(120px,25vh,140px));background:#f8f9fa;scroll-behavior:smooth}@media (max-width: 767px){#chat-body{height:calc(100vh - 130px);padding:1rem;-webkit-overflow-scrolling:touch}}.message{display:flex;margin-bottom:16px;animation:messageFadeIn .3s ease forwards;opacity:0}@keyframes messageFadeIn{to{opacity:1;transform:translateY(0)}}.message-content{max-width:85%;padding:clamp(10px,3vw,16px);border-radius:16px;font-size:clamp(14px,4vw,16px);line-height:1.5;position:relative;word-wrap:break-word}@media (max-width: 767px){.message-content{max-width:90%;font-size:1rem}}.server-message .message-content{background:#fff;box-shadow:0 2px 4px #0000000f;border-bottom-left-radius:4px;margin-right:auto}.user-message{justify-content:flex-end}.user-message .message-content{background:#6c5ce7;color:#fff;border-bottom-right-radius:4px}#chat-footer{padding:clamp(12px,4vw,16px);background:#fff;display:flex;gap:clamp(8px,2vw,12px);align-items:center;border-top:1px solid rgba(0,0,0,.06);position:absolute;bottom:0;left:0;right:0;height:clamp(70px,10vh,80px);box-sizing:border-box}@media (max-width: 767px){#chat-footer{padding:12px;gap:12px;height:70px;position:fixed;bottom:0;left:0;right:0;width:100%;box-shadow:0 -2px 10px #0000000d}}#chat-input{flex:1;padding:clamp(10px,3vw,12px) clamp(12px,4vw,16px);border:1px solid #e1e1e1;border-radius:20px;outline:none;font-size:clamp(14px,4vw,15px);line-height:1.5;background:#f8f9fa;transition:border-color .2s ease,box-shadow .2s ease}#chat-input:focus{border-color:#6c5ce7;box-shadow:0 0 0 3px #6c5ce71f}#chat-footer button{background:#6c5ce7;color:#fff;border:none;border-radius:50%;width:clamp(36px,10vw,44px);height:clamp(36px,10vw,44px);padding:0;cursor:pointer;transition:all .2s cubic-bezier(.4,0,.2,1);display:flex;align-items:center;justify-content:center;flex-shrink:0}#chat-footer button svg{width:clamp(16px,5vw,20px);height:clamp(16px,5vw,20px)}@media (max-width: 767px){#chat-footer button{width:48px;height:48px}#chat-footer button svg{width:24px;height:24px}}#chat-footer button:hover{background:#5b4cc4;transform:scale(1.05)}#chat-footer button:active{transform:scale(.95)}#voice-button.recording{animation:pulseRecording 1.5s ease infinite}@keyframes pulseRecording{0%{transform:scale(1);background:#ff4757}50%{transform:scale(1.1);background:#ff6b81}to{transform:scale(1);background:#ff4757}}.product-card img{width:100%;height:auto;max-height:35vh;object-fit:cover}@media (max-width: 767px){.product-card img{max-height:30vh}}.product-details{padding:12px;padding:clamp(10px,3vw,12px)}.product-details h4{margin:8px 0;font-size:clamp(14px,4vw,16px)}.product-details p{margin:8px 0;color:#666;font-size:clamp(12px,3.5vw,14px)}.product-details strong{display:block;margin:8px 0;font-size:clamp(16px,4.5vw,18px);color:#6c5ce7}.action-buttons{display:flex;flex-wrap:wrap;gap:8px;margin-top:8px}.action-button,.product-action-button{background:#6c5ce7;color:#fff;border:none;border-radius:20px;padding:clamp(6px,2vw,8px) clamp(10px,3vw,12px);cursor:pointer;transition:background .2s ease;font-size:clamp(12px,3.5vw,14px);white-space:nowrap}.action-button:hover,.product-action-button:hover{background:#5b4cc4}@media (prefers-color-scheme: dark){#my-chat-window{background:#1a1a1a}#chat-body{background:#262626}#chat-footer,.server-message .message-content{background:#333;color:#fff}#chat-input{background:#444;color:#fff;border-color:#555}.product-card{background:#333}.product-details p{color:#ccc}}.product-card{border:1px solid #e1e1e1;border-radius:16px;overflow:hidden;display:flex;flex-direction:column;background:#fff;width:100%;max-width:100%;margin-bottom:8px;box-shadow:0 2px 8px #0000000d;transition:transform .2s ease,box-shadow .2s ease}.product-card:hover{box-shadow:0 4px 12px #0000001a;transform:translateY(-2px)}.product-image-container{position:relative;width:100%}.product-card img{width:100%;height:auto;max-height:200px;object-fit:cover;border-bottom:1px solid #f0f0f0}@media (max-width: 767px){.product-card img{max-height:180px}}.discount-badge{position:absolute;top:10px;right:10px;background:#e74c3c;color:#fff;padding:4px 8px;border-radius:12px;font-size:12px;font-weight:700}.product-details h4{margin:0 0 8px;font-size:16px;color:#333}.product-details p{margin:8px 0;color:#666;font-size:14px;line-height:1.4}.product-rating{display:flex;align-items:center;margin-bottom:8px}.stars{display:inline-flex;margin-right:6px}.star{color:#f39c12;font-size:14px}.star.empty{color:#e1e1e1}.star.half{position:relative;color:#e1e1e1}.star.half:before{content:"‚òÖ";position:absolute;color:#f39c12;width:50%;overflow:hidden}.rating-value{font-size:14px;color:#666}.product-price{display:flex;align-items:center;margin:10px 0}.product-price strong{font-size:18px;color:#2ecc71;margin-right:8px}.original-price{text-decoration:line-through;color:#999;font-size:14px}.shipping-info{font-size:12px;color:#3498db;margin-top:4px}.out-of-stock{display:inline-block;padding:2px 6px;background:#f1f1f1;color:#e74c3c;font-size:12px;border-radius:4px;margin-top:4px}.product-actions{display:flex;flex-wrap:wrap;gap:8px;padding:clamp(10px,3vw,12px);justify-content:flex-end}.product-action-button{background:#6c5ce7;color:#fff;border:none;border-radius:20px;padding:8px 16px;cursor:pointer;transition:background .2s ease,transform .1s ease;font-size:14px;text-decoration:none;display:inline-flex;align-items:center;justify-content:center}.product-action-button:hover{background:#5b4cc4;transform:scale(1.05)}.product-action-button:active{transform:scale(.95)}.product-action-button[data-action^=buy_]{background:#2ecc71}.product-action-button[data-action^=buy_]:hover{background:#27ae60}.product-action-button[data-action^=details_]{background:#3498db}.product-action-button[data-action^=details_]:hover{background:#2980b9}@media (max-width: 767px){.product-actions{flex-direction:column}.product-action-button{width:100%}}'},Symbol.toStringTag,{value:"Module"}))})();
