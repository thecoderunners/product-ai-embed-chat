(function(){"use strict";const y="#my-chat-widget *{box-sizing:border-box;font-family:Inter,-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,sans-serif}#my-chat-widget button.chat-toggle{background:#6c5ce7;color:#fff;border:none;border-radius:50%;width:clamp(60px,15vw,80px);height:clamp(60px,15vw,80px);font-size:clamp(24px,4vw,32px);cursor:pointer;box-shadow:0 4px 12px #6c5ce766;transition:all .3s cubic-bezier(.4,0,.2,1);display:flex;align-items:center;justify-content:center;z-index:10001;position:relative}#my-chat-widget button.chat-toggle:hover{transform:scale(1.05);box-shadow:0 6px 16px #6c5ce780}#my-chat-widget button.chat-toggle:active{transform:scale(.95)}@media (max-width: 767px){#my-chat-widget button.chat-toggle{width:80px;height:80px;font-size:32px;position:fixed;bottom:20px;right:20px}}#my-chat-window{display:none;width:min(450px,calc(100vw - 40px));height:min(650px,80vh);background:#fff;border-radius:24px;overflow:hidden;position:fixed;bottom:100px;right:20px;box-shadow:0 12px 28px #00000026;z-index:10002;transition:all .3s ease}@media (max-width: 767px){#my-chat-window{width:100%;height:100%;bottom:0;right:0;left:0;top:0;border-radius:0;max-height:none;position:fixed;margin:0;padding:0}#my-chat-window.chat-show{animation:slideUpFullScreen .3s cubic-bezier(.4,0,.2,1) forwards}#my-chat-window.chat-hide{animation:slideDownFullScreen .3s cubic-bezier(.4,0,.2,1) forwards}}@media (min-width: 768px) and (max-width: 1023px){#my-chat-window{width:min(600px,85vw);height:min(700px,85vh)}}@media (min-width: 1024px){#my-chat-window{width:min(450px,35vw);height:min(650px,75vh)}}.chat-show{display:block!important;animation:slideUp .3s cubic-bezier(.4,0,.2,1) forwards}.chat-hide{animation:slideDown .3s cubic-bezier(.4,0,.2,1) forwards}@keyframes slideUp{0%{opacity:0;transform:translateY(20px) scale(.98)}to{opacity:1;transform:translateY(0) scale(1)}}@keyframes slideDown{0%{opacity:1;transform:translateY(0) scale(1)}to{opacity:0;transform:translateY(20px) scale(.98)}}@keyframes slideUpFullScreen{0%{opacity:0;transform:translateY(20px)}to{opacity:1;transform:translateY(0)}}@keyframes slideDownFullScreen{0%{opacity:1;transform:translateY(0)}to{opacity:0;transform:translateY(20px)}}@media (max-width: 767px){html.chat-open,body.chat-open{overflow:hidden!important;position:fixed;width:100%;height:100%}}#chat-header{background:#6c5ce7;color:#fff;padding:clamp(16px,5vw,20px);font-size:clamp(16px,4vw,18px);font-weight:600;text-align:center;display:flex;justify-content:space-between;align-items:center}@media (max-width: 767px){#chat-header{padding:1rem;position:sticky;top:0;z-index:10003;box-shadow:0 2px 8px #0000001a;font-size:20px}}.close-button{background:none;border:none;color:#fff;cursor:pointer;padding:clamp(6px,1.5vw,8px);display:flex;align-items:center;justify-content:center;border-radius:50%;transition:background-color .2s}.close-button:hover{background:#ffffff1a}.close-button svg{width:clamp(18px,5vw,20px);height:clamp(18px,5vw,20px)}#chat-body{padding:clamp(16px,5vw,20px);overflow-y:auto;height:calc(100% - clamp(120px,25vh,140px));background:#f8f9fa;scroll-behavior:smooth}@media (max-width: 767px){#chat-body{height:calc(100vh - 130px);padding:1rem;-webkit-overflow-scrolling:touch}}.message{display:flex;margin-bottom:16px;animation:messageFadeIn .3s ease forwards;opacity:0}@keyframes messageFadeIn{to{opacity:1;transform:translateY(0)}}.message-content{max-width:85%;padding:clamp(10px,3vw,16px);border-radius:16px;font-size:clamp(14px,4vw,16px);line-height:1.5;position:relative;word-wrap:break-word}@media (max-width: 767px){.message-content{max-width:90%;font-size:1rem}}.server-message .message-content{background:#fff;box-shadow:0 2px 4px #0000000f;border-bottom-left-radius:4px;margin-right:auto}.user-message{justify-content:flex-end}.user-message .message-content{background:#6c5ce7;color:#fff;border-bottom-right-radius:4px}#chat-footer{padding:clamp(12px,4vw,16px);background:#fff;display:flex;gap:clamp(8px,2vw,12px);align-items:center;border-top:1px solid rgba(0,0,0,.06);position:absolute;bottom:0;left:0;right:0;height:clamp(70px,10vh,80px);box-sizing:border-box}@media (max-width: 767px){#chat-footer{padding:12px;gap:12px;height:70px;position:fixed;bottom:0;left:0;right:0;width:100%;box-shadow:0 -2px 10px #0000000d}}#chat-input{flex:1;padding:clamp(10px,3vw,12px) clamp(12px,4vw,16px);border:1px solid #e1e1e1;border-radius:20px;outline:none;font-size:clamp(14px,4vw,15px);line-height:1.5;background:#f8f9fa;transition:border-color .2s ease,box-shadow .2s ease}#chat-input:focus{border-color:#6c5ce7;box-shadow:0 0 0 3px #6c5ce71f}#chat-footer button{background:#6c5ce7;color:#fff;border:none;border-radius:50%;width:clamp(36px,10vw,44px);height:clamp(36px,10vw,44px);padding:0;cursor:pointer;transition:all .2s cubic-bezier(.4,0,.2,1);display:flex;align-items:center;justify-content:center;flex-shrink:0}#chat-footer button svg{width:clamp(16px,5vw,20px);height:clamp(16px,5vw,20px)}@media (max-width: 767px){#chat-footer button{width:48px;height:48px}#chat-footer button svg{width:24px;height:24px}}#chat-footer button:hover{background:#5b4cc4;transform:scale(1.05)}#chat-footer button:active{transform:scale(.95)}#voice-button.recording{animation:pulseRecording 1.5s ease infinite}@keyframes pulseRecording{0%{transform:scale(1);background:#ff4757}50%{transform:scale(1.1);background:#ff6b81}to{transform:scale(1);background:#ff4757}}.product-card{border:1px solid #e1e1e1;border-radius:12px;overflow:hidden;display:flex;flex-direction:column;background:#fff;width:100%;max-width:100%}.product-card img{width:100%;height:auto;max-height:35vh;object-fit:cover}@media (max-width: 767px){.product-card img{max-height:30vh}}.product-details{padding:clamp(10px,3vw,12px)}.product-details h4{margin:8px 0;font-size:clamp(14px,4vw,16px)}.product-details p{margin:8px 0;color:#666;font-size:clamp(12px,3.5vw,14px)}.product-details strong{display:block;margin:8px 0;font-size:clamp(16px,4.5vw,18px);color:#6c5ce7}.product-actions{display:flex;gap:8px;padding:clamp(10px,3vw,12px);justify-content:flex-end}.action-buttons{display:flex;flex-wrap:wrap;gap:8px;margin-top:8px}.action-button,.product-action-button{background:#6c5ce7;color:#fff;border:none;border-radius:20px;padding:clamp(6px,2vw,8px) clamp(10px,3vw,12px);cursor:pointer;transition:background .2s ease;font-size:clamp(12px,3.5vw,14px);white-space:nowrap}.action-button:hover,.product-action-button:hover{background:#5b4cc4}@media (prefers-color-scheme: dark){#my-chat-window{background:#1a1a1a}#chat-body{background:#262626}#chat-footer,.server-message .message-content{background:#333;color:#fff}#chat-input{background:#444;color:#fff;border-color:#555}.product-card{background:#333}.product-details p{color:#ccc}}";function k(o){const s=document.createElement("style");s.textContent=o,document.head.appendChild(s)}k(y),function(){if(!document.querySelector('meta[name="viewport"]')){const t=document.createElement("meta");t.name="viewport",t.content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no",document.head.appendChild(t)}const o={info:(...t)=>console.log("üì± [Chat Widget]:",...t),error:(...t)=>console.error("‚ùå [Chat Widget]:",...t),warn:(...t)=>console.warn("‚ö†Ô∏è [Chat Widget]:",...t)};o.info("Initializing chat widget...");const s=document.createElement("div");s.id="my-chat-widget",s.style.position="fixed",s.style.bottom="20px",s.style.right="20px",s.style.zIndex="10000",document.body.appendChild(s),o.info("Chat container created");const u=document.createElement("button");u.className="chat-toggle",u.innerHTML=`
    <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
      <path d="M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z"></path>
    </svg>
  `,s.appendChild(u);const c=document.createElement("div");c.id="my-chat-window",s.appendChild(c),o.info("Chat button and window created");let h=!1;function m(){return window.innerWidth<768}function x(){o.info("Toggling chat window, current state:",h),h?(c.classList.remove("chat-show"),c.classList.add("chat-hide"),c.addEventListener("animationend",()=>{c.style.display="none",h=!1,document.documentElement.classList.remove("chat-open"),document.body.classList.remove("chat-open"),document.body.style.overflow=""},{once:!0})):(c.style.display="block",c.classList.add("chat-show"),c.classList.remove("chat-hide"),h=!0,m()&&(document.documentElement.classList.add("chat-open"),document.body.classList.add("chat-open"),document.body.style.overflow="hidden",setTimeout(()=>{window.scrollTo(0,0)},10)),z())}u.addEventListener("click",x),window.addEventListener("resize",()=>{if(h){const t=document.getElementById("chat-body");t&&(t.style.height=m()?"calc(100% - 120px)":"calc(100% - clamp(120px, 25vh, 140px))")}});function z(){o.info("Loading chat interface..."),fetch("http://localhost:3000/api/chat/init",{method:"GET",credentials:"include"}).then(t=>(o.info("Chat init API response received"),t.json())).then(t=>{c.innerHTML=`
          <div id="chat-header">
            <span>Chat</span>
            <button class="close-button" aria-label="Close chat">
              <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <line x1="18" y1="6" x2="6" y2="18"></line>
                <line x1="6" y1="6" x2="18" y2="18"></line>
              </svg>
            </button>
          </div>
          <div id="chat-body"></div>
          <div id="chat-footer">
            <input type="text" id="chat-input" placeholder="Type a message..." />
            <button id="voice-button" title="Voice Input">
              <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <path d="M12 1a3 3 0 0 0-3 3v8a3 3 0 0 0 6 0V4a3 3 0 0 0-3-3z"></path>
                <path d="M19 10v2a7 7 0 0 1-14 0v-2"></path>
                <line x1="12" y1="19" x2="12" y2="23"></line>
                <line x1="8" y1="23" x2="16" y2="23"></line>
              </svg>
            </button>
            <button id="send-message">
              <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <line x1="22" y1="2" x2="11" y2="13"></line>
                <polygon points="22 2 15 22 11 13 2 9 22 2"></polygon>
              </svg>
            </button>
          </div>
        `,c.querySelector(".close-button").addEventListener("click",e=>{e.stopPropagation(),x()}),t.messages&&Array.isArray(t.messages)?t.messages.forEach(e=>{g(e)}):g({type:"text",content:"Hi! How can I help you today?"}),$(),o.info("Chat interface loaded and initialized")}).catch(t=>{o.error("Error loading chat interface:",t),c.innerHTML=`
          <div class="error-state" style="padding:20px; text-align:center; color:#ff4757;">
            <svg width="48" height="48" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <circle cx="12" cy="12" r="10"></circle>
              <line x1="12" y1="8" x2="12" y2="12"></line>
              <line x1="12" y1="16" x2="12.01" y2="16"></line>
            </svg>
            <p>Unable to load chat. Please try again later.</p>
          </div>
        `})}function g(t){const i=document.getElementById("chat-body"),e=document.createElement("div");switch(e.className="message server-message",t.type){case"text":e.innerHTML=`
            <div class="message-content">
              ${t.content}
            </div>
          `;break;case"product":const a=t.originalPrice?Math.round((t.originalPrice-t.price)/t.originalPrice*100):0,n=t.rating?E(t.rating):"";e.innerHTML=`
            <div class="product-card">
              <div class="product-image-container">
                <img src="${t.imageUrl}" alt="${t.title}" loading="lazy" />
                ${a>0?`<div class="discount-badge">-${a}%</div>`:""}
              </div>
              <div class="product-details">
                <h4>${t.title}</h4>
                <div class="product-rating">${n}</div>
                <p>${t.description}</p>
                <div class="product-price">
                  <strong>${b(t.price)}</strong>
                  ${t.originalPrice?`<span class="original-price">${b(t.originalPrice)}</span>`:""}
                </div>
                ${t.shipping?`<div class="shipping-info">${t.shipping}</div>`:""}
                ${t.inStock===!1?'<div class="out-of-stock">Out of Stock</div>':""}
              </div>
              <div class="product-actions">
                ${t.actions.map(d=>`
                  ${d.url?`<a href="${d.url}" class="product-action-button" data-action="${d.value}">${d.label}</a>`:`<button class="product-action-button" data-action="${d.value}">${d.label}</button>`}
                `).join("")}
              </div>
            </div>
          `;break;case"action":e.innerHTML=`
          <div class="message-content">
            <p>${t.question}</p>
            <div class="action-buttons">
              ${t.options.map(d=>`<button class="action-button" data-action="${d.value}">${d.label}</button>`).join("")}
            </div>
          </div>
        `;break;case"image":e.innerHTML=`
          <div class="message-content">
            <img src="${t.imageUrl}" alt="Image message" style="max-width:100%; border-radius:8px;" />
            ${t.caption?`<p>${t.caption}</p>`:""}
          </div>
        `;break;default:e.innerHTML='<div class="message-content">Unknown message type.</div>'}i.appendChild(e),i.scrollTop=i.scrollHeight,e.querySelectorAll(".action-button, .product-action-button:not(a)").forEach(a=>{a.addEventListener("click",()=>{const n=a.getAttribute("data-action");o.info("Action button clicked:",n),w({action:n})})})}function E(t){const i=Math.round(t*2)/2;let e="";for(let a=1;a<=Math.floor(i);a++)e+='<span class="star full">‚òÖ</span>';i%1!==0&&(e+='<span class="star half">‚òÖ</span>');const p=5-Math.ceil(i);for(let a=0;a<p;a++)e+='<span class="star empty">‚òÜ</span>';return`<div class="stars">${e}</div><span class="rating-value">${t.toFixed(1)}</span>`}function b(t){return`$${t.toFixed(2)}`}const S=`
  /* Product Card Enhancements */
  .product-card {
    border: 1px solid #e1e1e1;
    border-radius: 16px;
    overflow: hidden;
    display: flex;
    flex-direction: column;
    background: #fff;
    width: 100%;
    margin-bottom: 8px;
    box-shadow: 0 2px 8px rgba(0, 0, 0, 0.05);
    transition: transform 0.2s ease, box-shadow 0.2s ease;
  }
  
  .product-card:hover {
    box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
    transform: translateY(-2px);
  }
  
  .product-image-container {
    position: relative;
    width: 100%;
  }
  
  .product-card img {
    width: 100%;
    height: auto;
    max-height: 200px;
    object-fit: cover;
    border-bottom: 1px solid #f0f0f0;
  }
  
  @media (max-width: 767px) {
    .product-card img {
      max-height: 180px;
    }
  }
  
  .discount-badge {
    position: absolute;
    top: 10px;
    right: 10px;
    background: #e74c3c;
    color: white;
    padding: 4px 8px;
    border-radius: 12px;
    font-size: 12px;
    font-weight: bold;
  }
  
  .product-details {
    padding: 12px;
  }
  
  .product-details h4 {
    margin: 0 0 8px 0;
    font-size: 16px;
    color: #333;
  }
  
  .product-details p {
    margin: 8px 0;
    color: #666;
    font-size: 14px;
    line-height: 1.4;
  }
  
  .product-rating {
    display: flex;
    align-items: center;
    margin-bottom: 8px;
  }
  
  .stars {
    display: inline-flex;
    margin-right: 6px;
  }
  
  .star {
    color: #f39c12;
    font-size: 14px;
  }
  
  .star.empty {
    color: #e1e1e1;
  }
  
  .star.half {
    position: relative;
    color: #e1e1e1;
  }
  
  .star.half:before {
    content: '‚òÖ';
    position: absolute;
    color: #f39c12;
    width: 50%;
    overflow: hidden;
  }
  
  .rating-value {
    font-size: 14px;
    color: #666;
  }
  
  .product-price {
    display: flex;
    align-items: center;
    margin: 10px 0;
  }
  
  .product-price strong {
    font-size: 18px;
    color: #2ecc71;
    margin-right: 8px;
  }
  
  .original-price {
    text-decoration: line-through;
    color: #999;
    font-size: 14px;
  }
  
  .shipping-info {
    font-size: 12px;
    color: #3498db;
    margin-top: 4px;
  }
  
  .out-of-stock {
    display: inline-block;
    padding: 2px 6px;
    background: #f1f1f1;
    color: #e74c3c;
    font-size: 12px;
    border-radius: 4px;
    margin-top: 4px;
  }
  
  .product-actions {
    display: flex;
    flex-wrap: wrap;
    gap: 8px;
    padding: 8px 12px 16px;
    justify-content: center;
  }
  
  .product-action-button {
    background: #6c5ce7;
    color: white;
    border: none;
    border-radius: 20px;
    padding: 8px 16px;
    cursor: pointer;
    transition: background 0.2s ease, transform 0.1s ease;
    font-size: 14px;
    text-decoration: none;
    display: inline-flex;
    align-items: center;
    justify-content: center;
  }
  
  .product-action-button:hover {
    background: #5b4cc4;
    transform: scale(1.05);
  }
  
  .product-action-button:active {
    transform: scale(0.95);
  }

  /* Special styling for Buy Now button */
  .product-action-button[data-action^="buy_"] {
    background: #2ecc71;
  }
  
  .product-action-button[data-action^="buy_"]:hover {
    background: #27ae60;
  }
  
  /* Different color for View Details button */
  .product-action-button[data-action^="details_"] {
    background: #3498db;
  }
  
  .product-action-button[data-action^="details_"]:hover {
    background: #2980b9;
  }
  
  @media (max-width: 767px) {
    .product-actions {
      flex-direction: column;
    }
    
    .product-action-button {
      width: 100%;
    }
  }
`;function C(){const t=document.createElement("style");t.textContent=S,document.head.appendChild(t)}function w(t){o.info("Sending message payload to server:",t),fetch("http://localhost:3000/api/chat/message",{method:"POST",credentials:"include",headers:{"Content-Type":"application/json"},body:JSON.stringify(t)}).then(i=>(o.info("Server response received"),i.json())).then(i=>{o.info("Processing server response:",i);const e=document.getElementById("chat-body");i.messages&&Array.isArray(i.messages)&&i.messages.forEach(p=>{g(p)}),e.scrollTop=e.scrollHeight}).catch(i=>{o.error("Error in server communication:",i);const e=document.getElementById("chat-body");g({type:"text",content:"Sorry, I couldn't process your message. Please try again."}),e.scrollTop=e.scrollHeight})}function $(){const t=document.getElementById("send-message"),i=document.getElementById("voice-button"),e=document.getElementById("chat-input"),p=document.getElementById("chat-body");o.info("Setting up chat messaging components");let a=!1,n=null;function d(r){return r.replace(/[<>]/g,"").trim()}function f(){const r=d(e.value);r!==""&&(o.info("Sending message:",r),L(r),e.value="",p.scrollTop=p.scrollHeight,w({message:r}))}function L(r){const l=document.createElement("div");l.className="message user-message",l.innerHTML=`<div class="message-content">${r}</div>`,p.appendChild(l),o.info("User message appended to chat")}t.addEventListener("click",f),e.addEventListener("keyup",function(r){r.key==="Enter"&&!r.shiftKey&&(r.preventDefault(),f())}),i.addEventListener("click",function(){if(!("webkitSpeechRecognition"in window)&&!("SpeechRecognition"in window)){o.warn("Speech recognition not supported in this browser"),alert("Voice recognition is not supported in your browser.");return}if(a){o.info("Stopping voice recording"),n&&n.stop();return}const r=window.SpeechRecognition||window.webkitSpeechRecognition;n=new r,n.continuous=!1,n.interimResults=!0,n.lang="en-US",n.onstart=()=>{o.info("Voice recognition started"),a=!0,i.classList.add("recording")},n.onend=()=>{o.info("Voice recognition ended"),a=!1,i.classList.remove("recording"),n=null},n.onerror=l=>{o.error("Voice recognition error:",l.error),a=!1,i.classList.remove("recording"),n=null},n.onresult=l=>{const v=Array.from(l.results).map(B=>B[0].transcript).join("");o.info("Voice recognition result:",v),e.value=v,l.results[0].isFinal&&f()};try{n.start(),o.info("Attempting to start voice recognition")}catch(l){o.error("Error starting voice recognition:",l),alert("Error starting voice recognition. Please try again.")}}),e.focus(),o.info("Chat messaging setup completed")}C(),o.info("Chat widget initialized")}()})();
